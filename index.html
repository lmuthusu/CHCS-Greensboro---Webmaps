<!DOCTYPE html>
<html lang="en">
<head>
    
    <title>Webmap 201</title>
      <meta charset="utf-8" />

       <!-- Adding reference to CSS folder -->
    <link rel="stylesheet" href="src/leaflet/leaflet.css">

    <!-- Adding reference to Bootstrap folder -->
    <link rel="stylesheet" href="src/css/bootstrap-grid.css">
    <link rel ="stylesheet"href="src/Leaflet.NavBar-master/Leaflet.NavBar.css">
    <link rel ="stylesheet"href="src/leaflet-search-master/src/leaflet-search.css">
    <!-- Adding reference to leaflet folder -->
    <script src="src/leaflet/leaflet-src.js"></script>
    <!-- Adding reference to Jquery folder -->
    <script src ="src/jquery-3.4.1.min.js"></script>
    <!-- Script References -->
    <script src="js/leaflet-providers.js"></script>
    <script src='https://api.mapbox.com/mapbox-gl-js/v1.0.0/mapbox-gl.js'></script>    
    <link href='https://api.mapbox.com/mapbox-gl-js/v1.0.0/mapbox-gl.css' rel='stylesheet' />
    <script src="js/Leaflet.NavBar.js"></script>
    <script src ="src/leaflet-search-master/src/leaflet-search.js"></script>
    

    
 <!-- Load Esri Leaflet from CDN -->
  <script src="https://unpkg.com/esri-leaflet@2.3.0/dist/esri-leaflet.js"
  integrity="sha512-1tScwpjXwwnm6tTva0l0/ZgM3rYNbdyMj5q6RSQMbNX6EUMhYDE3pMRGZaT41zHEvLoWEK7qFEJmZDOoDMU7/Q=="
  crossorigin=""></script>
<script src="https://unpkg.com/esri-leaflet-renderers@2.0.2"></script> 
    
    <!-- Load Esri Leaflet Geocoder from CDN -->
  <link rel="stylesheet" href="https://unpkg.com/esri-leaflet-geocoder@2.2.14/dist/esri-leaflet-geocoder.css"
    integrity="sha512-v5YmWLm8KqAAmg5808pETiccEohtt8rPVMGQ1jA6jqkWVydV5Cuz3nJ9fQ7ittSxvuqsvI9RSGfVoKPaAJZ/AQ=="
    crossorigin="">
  <script src="https://unpkg.com/esri-leaflet-geocoder@2.2.14/dist/esri-leaflet-geocoder.js"
    integrity="sha512-uK5jVwR81KVTGe8KpJa1QIN4n60TsSV8+DPbL5wWlYQvb0/nYNgSOg9dZG6ViQhwx/gaMszuWllTemL+K+IXjg=="
    crossorigin="">    
    </script>
    <!-- Load Esri Leaflet Renderers from CDN --> <!-- Load Esri Leaflet from CDN -->

 
    <!-- Load Esri Leaflet Renderers -->
    <!-- This will hook into Esri Leaflet to get renderer info when adding a feature layer -->
    

        
    <!--starting the style here, eventually be moved to CSS folder; giving a ref a-->
    <style>
        #mapdiv{
            height:100vh;

        }
        
        
        #header {
            background-color:#0f2044;
            padding: 5px;

            
        }
        
        h1 {
            color: #e5e6e4;
            text-align : center;
        }
        
       ul {
      list-style-type: none;
          margin: 0;
          padding: 0;
          overflow:auto;
            }

        li {
            float: right;
            }

        li a {

          padding: 8px;
          background-color:#5F8E78 ;
            color: #ffb71b
            
        }
        
        a{

            padding: 8px;
            color:#ffb71b;
           
        }
        
                img {
           float: left;

            width: 10%;
}
  


        
        

        #calc{
            position: fixed;
            bottom: 10px;
            right:10px;
            z-index: 1000;
            background: #0f2044;
            width: 300px;
            height: 400px;
            padding: 1em;
            color: aliceblue;
            opacity: 0.8;
            
        }
        
    </style>
</head>
    
<body>

<!-- Load Esri Leaflet Renderers plugin to use feature service symbology -->

 <!-- <div id="side-bar" class="col-md-3"></div>
 <!--defining sidebar id "side-bar" --> 
      

    <div id ="header">
        <img src ="src/images/uncgreensboro_chcs_h_3-color-reversed.png" align="left"alt="logo" />
    <h1 class="center">Opportunity Finder</h1>
   
        <!-- Including the tabs-->
        <a href =" https://chcs.uncg.edu/about/">About Us</a>
        <a href =" https://uncg.edu/">UNC Greensboro</a>
        <a href="https://github.com/lmuthusu/Webmaps---Summer-2019/" align = "right">Source Code</a>
     </div>
     

<!-- Map Div Element -->
    
   <div id ="mapdiv"class="col-md-12"></div> 
   
<!-- Leaflet Bar -->
    <style>
#query {
    position: fixed;
    bottom: 420px;
    right: 10px;
    z-index: 1000;
    background: #0f2044;
    width: 300px;
    padding: 1em;
    color: aliceblue;
    opacity: 0.8;
  }

  #query select {
    font-size: 16px;
    color:#0f2044;
    z-index: 1000;
    background: #0f2044;
    width: auto;
    padding: 1em;
    color: aliceblue;
    opacity: 0.8;
    
  }
</style>
<div id="query" class="leaflet-bar">
  <label>
   
    Land Type:
    <select id="proptype">
    <!-- make sure to encase string values in single quotes for valid sql -->
        <option value="1=1">CHOOSE</option>
        <option value="LAND_CLASS='RESIDENTIAL'">RESIDENTIAL</option>
        <option value="LAND_CLASS='TOWNHOUSE'">TOWNHOUSE</option>
        <option value="LAND_CLASS='APART'">APARTMENT</option>
        <option value="LAND_CLASS='IND'">INDIVIDUAL PROPERTY</option>
        <option value="LAND_CLASS='CONDO'">CONDOMINIUM</option>
        <option value="LAND_CLASS='MULTI-FAMILY<4'">MULTI FAMILY</option>
        <option value="LAND_CLASS='GOV OWNED'">GOVT OWNED</option>
        <option value="LAND_CLASS='VACANT'">VACANT</option> 
        <option value="LAND_CLASS='INSTITUTIONAL'">INSTITUTIONAL</option>
        <option value="LAND_CLASS='COMM'">COMMERCIAL</option>
  </select>
  </label></div>
    

<!-- Leaflet Bar Contents calc -->      
  <div id ="calc" class="leaflet-bar"> 
   <label> LOT CALCULATOR (in acres) </label>
      <br><br>Total Lot Size : <div id="selectedFeatures"></div>
       <br><br> Residential  : <div id="residential"></div>
       <br><br> Governement owned  : <div id="gov"></div>
       
       <br><br> Other area :<div id="oth"></div>
       <br><br> Vacant area :<div id ="vac"></div>     
</div>
   
<!-- Javascript part -->
<!-- Elementdiv HTML gets passed here -->    
   <script type ="text/javascript">
       
/* ESRI Link and contributors */  
   mapLink = '<a href="http://www.esri.com/">Esri</a>';
   wholink = 'i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community';
       
       
       
       
/* Defining the map elements */
/* Stamen tile definition */
var stamen =      L.tileLayer('https://stamen-tiles-{s}.a.ssl.fastly.net/toner-lite/{z}/{x}/{y}{r}.{ext}', {
	attribution: 'Map tiles by <a href="http://stamen.com">Stamen Design</a>, <a href="http://creativecommons.org/licenses/by/3.0">CC BY 3.0</a> &mdash; Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
	subdomains: 'abcd',
	ext: 'png'
}),
/*ESRI World Tile definition*/
es_w = L.tileLayer('http://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', { attribution: '&copy; '+mapLink+', '+wholink});
       
       
     
    /*Declare Map div*/
    var mymap = L.map('mapdiv',{ 
        center :[36.08 , -79.79],
        zoom : 13,
        layers : [stamen, es_w]
    });
       
       
     
    /* Declare variable tot_area*/
       var total_area;
       
       
       
    /*Declare basemaps to be stamen and ESRI*/
       var baseMaps = {
           "Stamen toner": stamen,
           "ESRI World": es_w
            };
   /* Add the layers to mymap */
       var cont = L.control.layers(baseMaps).addTo(mymap);

   /* Add navigation controls to mymap */
       L.control.navbar().addTo(mymap);
       
    /* Add Scale to mymap */
       L.control.scale().addTo(mymap);
       

            
  /*Adding ESRI Feature layer from County website*/     
    var location_address = L.esri.featureLayer({
        url:'http://gis.guilfordcountync.gov/arcgis/rest/services/Cadastral/GC_Cadastral/MapServer/0',
         fields : ['REID','OBJECTID','LAND_CLASS','SITUS_ADDRESS','CALCULATED_ACREAGE','YEAR_BUILT'],
         simplifyFactor: 0.5,
         precision : 5,
         cacheLayers :true,
         useCors:true,
        isModern:false
      

       });
       
    location_address.setStyle(function (feature) {  /* Filtering styles */
         if (feature.properties.LAND_CLASS ==='RESIDENTIAL'){
          return {fillColor:'#226666',fill:true,fillOpacity :0.3};
          }
          if (feature.properties.LAND_CLASS === 'TOWNHOUSE'){
          return {fillColor:'#226667',fill:true,fillOpacity :0.3};   
          }
          if (feature.properties.LAND_CLASS ==='APART'){
          return {fillColor:'#226668',fill:true,fillOpacity :0.3};   
          }
          if (feature.properties.LAND_CLASS === 'IND'){
          return {fillColor:'#226669',fill:true,fillOpacity :0.3};   
          }
          if (feature.properties.LAND_CLASS === 'CONDO'){
          return {fillColor:'#226670',fill:true,fillOpacity :0.3};   
          }
          if (feature.properties.LAND_CLASS === 'GOV OWNED'){
          return {fillColor:'#AA3939',fill:true,fillOpacity :0.3};    
          }
          if (feature.properties.LAND_CLASS === 'INSTITUTIONAL'){
          return {fillColor:'#C5EE56',fill:true,fillOpacity :0.3};    
          }
          if (feature.properties.LAND_CLASS === 'VACANT'){
          return {fillColor:'#FF0000',fill:true,fillOpacity :0.8};   
          }
          if (feature.properties.LAND_CLASS ==='COMM'){
          return {fillColor:'#AA7A39',fill:true,fillOpacity :0.3};
           }
          else {
                return{fillColor:'#340000',fill:true,fillOpacity :0.8};
            
          }
    }); 
       
       
  mymap.on('zoom move', function() {
    if ( mymap.getZoom() < 17){
        mymap.removeLayer(location_address);
       /* mymap.dragging.enable();*/
    }
        else{
                 
        mymap.addLayer(location_address);  
        /* mymap.dragging.disable(); */
    }
       
    }); 
       
    var pane = document.getElementById('selectedFeatures');
    var res = document.getElementById('residential');
    var govt = document.getElementById('gov');
    var vact = document.getElementById('vac');
    var others = document.getElementById('oth');
 
    
       
    mymap.on('zoom move',iterateFeatures);
    location_address.on('zoom load',iterateFeatures);
    
   
    
    function iterateFeatures () {
           res_area = 0;
           total_area = 0;
           vac_area = 0;
           ins_area = 0;
           total_area=0;
           gov_area = 0;
           other_area = 0;
           location_address.eachActiveFeature(function(layer) {
               
               
               //var attrs = Object.keys(layer.feature.properties)
            
               total_area = total_area + layer.feature.properties.CALCULATED_ACREAGE;
               
               if(layer.feature.properties.LAND_CLASS == "RESIDENTIAL" | layer.feature.properties.LAND_CLASS == "TOWNHOUSE"|layer.feature.properties.LAND_CLASS == "CONDO"|layer.feature.properties.LAND_CLASS == "IND"| layer.feature.properties.LAND_CLASS =="MULTI-FAMILY<4"|layer.feature.properties.LAND_CLASS =="APART")
                   {
                      res_area = res_area+ layer.feature.properties.CALCULATED_ACREAGE;
                       
                   }
               else if (layer.feature.properties.LAND_CLASS =="GOV OWNED")
                   {
                      gov_area = gov_area+ layer.feature.properties.CALCULATED_ACREAGE;
                     
                   }
               
                else if (layer.feature.properties.LAND_CLASS =="INSTITUTIONAL")
                   {
                      ins_area = ins_area+ layer.feature.properties.CALCULATED_ACREAGE;
                      
                   }
              else if (layer.feature.properties.LAND_CLASS =="VACANT")
                   {
                      vac_area = vac_area+ layer.feature.properties.CALCULATED_ACREAGE;
                      
                   }
               else
                   {
                      other_area = other_area + layer.feature.properties.CALCULATED_ACREAGE;
                      
                   };
               

              return total_area;  
               
               
            
                   
  });

 pane.innerHTML = total_area.toFixed(1);
 res.innerHTML  = res_area.toFixed(1);
 govt.innerHTML = gov_area.toFixed(1);
 others.innerHTML = other_area.toFixed(1);
 vact.innerHTML = vac_area.toFixed(1);
}     
       
   location_address.bindPopup(function(evt) {
            return L.Util.template('<h3>{LAND_CLASS}</h3><hr /><p>This property is located at {SITUS_ADDRESS} and is built in the year {YEAR_BUILT} with id {OBJECTID}', evt.feature.properties);
       });
       
    


       

       
    var arcgisOnline = L.esri.Geocoding.arcgisOnlineProvider();

       //... adding data in searchLayer ...
    var searchControl = L.esri.Geocoding.geosearch({
    providers: [
      arcgisOnline,
      L.esri.Geocoding.featureLayerProvider({
           url:"http://gis.guilfordcountync.gov/arcgis/rest/services/Geocode_Services/GCStrt_Geocode/GeocodeServer/",
          searchFields: ['StreetName1'],
            bufferRadius: 15000,
          zoomToResult: 18,
        formatSuggestion: function(feature){
          return feature.properties.StreetName;
        }
      })
    ]
  }).addTo(mymap); 
        
       
 /* var highways =L.esri.featureLayer({
        url:'http://gis.guilfordcountync.gov/arcgis/rest/services/Basemaps/All_Map_Layers/MapServer/10',
        simplifyFactor: 0.05,
        minZoom :10,
        maxZoom: 13,

    }).addTo(mymap); */      

       

    //searchLayer is a L.LayerGroup contains searched markers
    
      var Propertytype = document.getElementById('proptype');
       
      Propertytype.addEventListener('change', function () {
          location_address.setWhere(Propertytype.value);
        });    
    </script>
    
 
    
</body>
</html>