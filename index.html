<!DOCTYPE html>
<html lang="en">
<head>
    
    <title>Webmap 201</title>
      <meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
       <!-- Adding reference to CSS folder -->
    <link rel="stylesheet" href="src/leaflet/leaflet.css">
    <!-- Adding reference to Bootstrap folder -->
    <link rel="stylesheet" href="src/css/bootstrap-grid.css">
    <link rel ="stylesheet"href="src/Leaflet.NavBar-master/Leaflet.NavBar.css">
    <link rel ="stylesheet"href="src/leaflet-search-master/src/leaflet-search.css">
    <!-- Adding reference to leaflet folder -->
    <script src="src/leaflet/leaflet-src.js"></script>
    <!-- Adding reference to Jquery folder -->
    <script src ="src/jquery-3.4.1.min.js"></script>
    <!-- Script References -->
    <script src="js/leaflet-providers.js"></script>
    <script src='https://api.mapbox.com/mapbox-gl-js/v1.0.0/mapbox-gl.js'></script>    
    <link href='https://api.mapbox.com/mapbox-gl-js/v1.0.0/mapbox-gl.css' rel='stylesheet' />
    <script src="js/Leaflet.NavBar.js"></script>
    <script src ="src/leaflet-search-master/src/leaflet-search.js"></script>
    
    <!-- Load Esri Leaflet from CDN -->
    <script src="https://unpkg.com/esri-leaflet@2.2.4/dist/esri-leaflet.js"
    integrity="sha512-tyPum7h2h36X52O2gz+Pe8z/3l+Y9S1yEUscbVs5r5aEY5dFmP1WWRY/WLLElnFHa+k1JBQZSCDGwEAnm2IxAQ=="
    crossorigin=""></script>
    
    <!-- Load Esri Leaflet Renderers from CDN -->
    <script src="https://unpkg.com/esri-leaflet-renderers@2.0.8/dist/esri-leaflet-renderers.js"></script>
    
    <!-- Load Esri Leaflet Geocoder from CDN -->
  <link rel="stylesheet" href="https://unpkg.com/esri-leaflet-geocoder@2.2.14/dist/esri-leaflet-geocoder.css"
    integrity="sha512-v5YmWLm8KqAAmg5808pETiccEohtt8rPVMGQ1jA6jqkWVydV5Cuz3nJ9fQ7ittSxvuqsvI9RSGfVoKPaAJZ/AQ=="
    crossorigin="">
  <script src="https://unpkg.com/esri-leaflet-geocoder@2.2.14/dist/esri-leaflet-geocoder.js"
    integrity="sha512-uK5jVwR81KVTGe8KpJa1QIN4n60TsSV8+DPbL5wWlYQvb0/nYNgSOg9dZG6ViQhwx/gaMszuWllTemL+K+IXjg=="
    crossorigin="">    
    </script>
    <!-- Load Esri Leaflet Renderers from CDN --> <!-- Load Esri Leaflet from CDN -->

 
    <!-- Load Esri Leaflet Renderers -->
    <!-- This will hook into Esri Leaflet to get renderer info when adding a feature layer -->
    > 

        
    <!--starting the style here, eventually be moved to CSS folder; giving a ref a-->
    <style>
        #mapdiv{
            height:100vh;

        }
        
        
        #header {
            background-color:#0f2044;
            padding: 5px;

            
        }
        
        h1 {
            color: #e5e6e4;
            text-align : center;
        }
        
       ul {
      list-style-type: none;
          margin: 0;
          padding: 0;
          overflow:auto;
            }

        li {
            float: right;
            }

        li a {

          padding: 8px;
          background-color:#5F8E78 ;
            color: #ffb71b
            
        }
        
        a{

            padding: 8px;
            color:#ffb71b;
           
        }
        
                img {
           float: left;

            width: 10%;
}
  

#query {
    position: fixed;
    bottom: 420px;
    right: 10px;
    z-index: 1000;
    background: #0f2044;
    width: 300px;
    padding: 1em;
    color: aliceblue;
    opacity: 0.8;
  }

  #query select {
    font-size: 16px;
    color:#0f2044;
    z-index: 1000;
    background: #0f2044;
    width: auto;
    padding: 1em;
    color: aliceblue;
    opacity: 0.8;
    
  }
        
        

        #calc{
            position: fixed;
            bottom: 10px;
            right:10px;
            z-index: 1000;
            background: #0f2044;
            width: 300px;
            height: 400px;
            padding: 1em;
            color: aliceblue;
            opacity: 0.8;
            
        }
        
    </style>
</head>
    
<body>
 <!-- <div id="side-bar" class="col-md-3"></div>
 <!--defining sidebar id "side-bar" --> 
      

    <div id ="header">
        <img src ="src/images/uncgreensboro_chcs_h_3-color-reversed.png" align="left"alt="logo" />
    <h1 class="center">Opportunity Finder</h1>
   
        <!-- Including the tabs-->
        <a href =" https://chcs.uncg.edu/about/">About Us</a>
        <a href =" https://uncg.edu/">UNC Greensboro</a>
        <a href="https://github.com/lmuthusu/Webmaps---Summer-2019/" align = "right">Source Code</a>
     </div>
     

<!-- Map Div Element -->
    
   <div id ="mapdiv"class="col-md-12"></div> 
   
<!-- Leaflet Bar -->
   
   <div id="query" class="leaflet-bar">
   
<!-- Dropdown List Box  eid-->
   
    <label>
  Land Type
  <select id="eid">
    <!-- make sure to encase string values in single quotes for valid sql -->
    <option value= "1=1 ">Any</option>
    <option value="Property_Type ='RESIDENTIAL'" >RESIDENTIAL</option>
    <option value="Property_Type ='TOWNHOUSE'" >TOWNHOUSE</option>
    <option value="Property_Type ='APART'" >APARTMENT</option>
    <option value ="Property_Type ='IND'">INDIVIDUAL PROPERTY</option>
    <option value ="Property_Type ='CONDO'">CONDOMINIUM</option>
    <option value="Property_Type ='MULTI-FAMILY<4'">MULTI FAMILY</option>
    <option value="Property_Type ='GOV OWNED'">GOVT OWNED</option>
    <option value="Property_Type ='VACANT'">VACANT</option> 
    <option value="Property_Type ='INSTITUTIONAL'">INSTITUTIONAL</option>
  </select>
  </label></div>
    

<!-- Leaflet Bar Contents calc -->      
  <div id ="calc" class="leaflet-bar"> 
   <label> LOT CALCULATOR (in acres) </label>
      <br><br>Total Lot Size : <div id="selectedFeatures"></div>
       <br><br> Residential  : <div id="residential"></div>
       <br><br> Governement owned  : <div id="gov"></div>
       
       <br><br> Other area :<div id="oth"></div>
       <br><br> Vacant area :<div id ="vac"></div>     
</div>
   
<!-- Javascript part -->
<!-- Elementdiv HTML gets passed here -->    
   <script type ="text/javascript">
       
/* ESRI Link and contributors */  
   mapLink = '<a href="http://www.esri.com/">Esri</a>';
   wholink = 'i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community';
       
       
       
       
/* Defining the map elements */
/* Stamen tile definition */
var stamen =      L.tileLayer('https://stamen-tiles-{s}.a.ssl.fastly.net/toner-lite/{z}/{x}/{y}{r}.{ext}', {
	attribution: 'Map tiles by <a href="http://stamen.com">Stamen Design</a>, <a href="http://creativecommons.org/licenses/by/3.0">CC BY 3.0</a> &mdash; Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
	subdomains: 'abcd',
	ext: 'png'
}),
/*ESRI World Tile definition*/
es_w = L.tileLayer('http://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', { attribution: '&copy; '+mapLink+', '+wholink});
       
       
     
    /*Declare Map div*/
    var mymap = L.map('mapdiv',{ 
        center :[36.08 , -79.79],
        zoom : 13,
        layers : [stamen, es_w]
    });
       
       
       
    /* Declare variable tot_area*/
       var total_area;
       
       
       
    /*Declare basemaps to be stamen and ESRI*/
       var baseMaps = {
           "Stamen toner": stamen,
           "ESRI World": es_w
            };
   /* Add the layers to mymap */
       var cont = L.control.layers(baseMaps).addTo(mymap);

   /* Add navigation controls to mymap */
       L.control.navbar().addTo(mymap);
       
    /* Add Scale to mymap */
       L.control.scale().addTo(mymap);
       

            
  /*Adding ESRI Feature layer from County website*/     
  var location_address = L.esri.featureLayer({
    url: 'http://gis.guilfordcountync.gov/arcgis/rest/services/Guilford_Parcels/GC_Parcels/MapServer/0',
    
        simplifyFactor: 0.35,
        precision: 5,
        fields: ['OBJECTID_1','Property_Type','LOCATION_ADDR','YEAR_BUILT','Lot_Size','REID'],
    
        style: function (feature) {  /* Filtering styles */
          if(feature.properties.Property_Type == 'RESIDENTIAL'){
          return {fillColor:'#226666',fill:true,fillOpacity :0.3};
          }
          if (feature.properties.Property_Type == 'TOWNHOUSE'){
          return {fillColor:'#226666',fill:true,fillOpacity :0.3};    
          }
          if (feature.properties.Property_Type == 'APART'){
          return {fillColor:'#226666',fill:true,fillOpacity :0.3};    
          }
          if (feature.properties.Property_Type == 'IND'){
          return {fillColor:'#226666',fill:true,fillOpacity :0.3};    
          }
          if (feature.properties.Property_Type == 'CONDO'){
          return {fillColor:'#226666',fill:true,fillOpacity :0.3};    
          }
          if (feature.properties.Property_Type == 'GOV OWNED'){
          return {fillColor:'#AA3939',fill:true,fillOpacity :0.3};    
          }
          if (feature.properties.Property_Type == 'INSTITUTIONAL'){
          return {fillColor:'#C5EE56',fill:true,fillOpacity :0.3};    
          }
          if (feature.properties.Property_Type == 'VACANT'){
          return {fillColor:'#FF0000',fill:true,fillOpacity :0.8};    
          }
          else if{feature.properties.Property_Type == ''
            return {fillColor:'#AA7A39',fill:true,fillOpacity :0.3};
           }
        },
      
      minZoom :15,
      maxZoom: 25
      
       }).addTo(mymap);
       
     
       
    var pane = document.getElementById('selectedFeatures');
    var res = document.getElementById('residential');
    var govt = document.getElementById('gov');
    var vact = document.getElementById('vac');
    var others = document.getElementById('oth');
        
       
    mymap.on('zoom move',iterateFeatures);
    location_address.on('load', iterateFeatures);
   
    
    function iterateFeatures () {
           res_area = 0;
           total_area = 0;
           vac_area = 0;
           ins_area = 0;
           total_area=0;
           gov_area = 0;
           other_area = 0;
           location_address.eachActiveFeature(function(layer) {
               console.log(total_area);
               //var attrs = Object.keys(layer.feature.properties)
               console.log(Object.keys(layer.feature.properties));
               total_area = total_area + layer.feature.properties.Lot_Size;
               
               if(layer.feature.properties.Property_Type == "RESIDENTIAL" | layer.feature.properties.Property_Type == "TOWNHOUSE"|layer.feature.properties.Property_Type == "CONDO"|layer.feature.properties.Property_Type == "IND"|layer.feature.properties.Property_Type =="MULTI-FAMILY<4"||layer.feature.properties.Property_Type =="APART")
                   {
                      res_area = res_area+ layer.feature.properties.Lot_Size;
                       console.log("res",res_area)
                   }
               if (layer.feature.properties.Property_Type =="GOV OWNED")
                   {
                      gov_area = gov_area+ layer.feature.properties.Lot_Size;
                       console.log("gov",gov_area)
                   }
               
                if (layer.feature.properties.Property_Type =="INSTITUTIONAL")
                   {
                      ins_area = ins_area+ layer.feature.properties.Lot_Size;
                       console.log("insti",ins_area)
                   }
              if (layer.feature.properties.Property_Type =="VACANT")
                   {
                      vac_area = vac_area+ layer.feature.properties.Lot_Size;
                       console.log("vacant",vac_area)
                   }
               else
                   {
                      other_area = other_area + layer.feature.properties.Lot_Size;
                       console.log("others",other_area)
                   }
               
                console.log(total_area);


              return total_area;  
               
               
            
                   
  });

 pane.innerHTML = total_area.toFixed(1);
 res.innerHTML  = res_area.toFixed(1);
 govt.innerHTML = gov_area.toFixed(1);
 others.innerHTML = other_area.toFixed(1);
 vact.innerHTML = vac_area.toFixed(1);
} 
    
    
  
       
       
     mymap.on('zoomend', function() {
    if ( mymap.getZoom() > 15){
        mymap.addLayer(location_address);  
    }
                 }); 
       
    location_address.bindPopup(function(evt) {
            return L.Util.template('<h3>{Property_Type}</h3><hr /><p>This property is located at {LOCATION_ADDR} and is built in the year {YEAR_BUILT}', evt.feature.properties);
       });

   var Propertytype = document.getElementById('eid');
       Propertytype.addEventListener('change', function(){
    location_address.setWhere(eid.value);
  });

       
    var arcgisOnline = L.esri.Geocoding.arcgisOnlineProvider();

       //... adding data in searchLayer ...
    var searchControl = L.esri.Geocoding.geosearch({
    providers: [
      arcgisOnline,
      L.esri.Geocoding.featureLayerProvider({
           url:"http://gis.guilfordcountync.gov/arcgis/rest/services/Geocode_Services/GCStrt_Geocode/GeocodeServer/",
          searchFields: ['StreetName'],
            bufferRadius: 15000,
          zoomToResult: 17,
        formatSuggestion: function(feature){
          return feature.properties.StreetName;
        }
      })
    ]
  }).addTo(mymap); 
        
       
  /*var highways =L.esri.featureLayer({
        url:'http://gis.guilfordcountync.gov/arcgis/rest/services/Basemaps/All_Map_Layers/MapServer/10',
        simplifyFactor: 0.05,
        minZoom :10,
        maxZoom: 13,

    }).addTo(mymap); */      

       

    //searchLayer is a L.LayerGroup contains searched markers
    
       
    </script>
    
 
    
</body>
</html>